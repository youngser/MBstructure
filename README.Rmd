---
output: 
    html_document:
      css: ~/RFolder/pandoc.css
      fig_height: 6
      fig_width: 6
      highlight: pygments
      keep_md: yes
#        number_sections: yes
    theme: cerulean
#        toc: yes
#        toc_depth: 3
#        toc_float: no
---

```{r setup, include=FALSE, results='asis'}
library(knitr)
knitr::opts_chunk$set(echo=TRUE, eval=FALSE,warning=FALSE)

opts_knit$set(aliases=c(h='fig.height', w='fig.width', cap='fig.cap', scap='fig.scap'))                                                                               
opts_knit$set(eval.after = c('fig.cap','fig.scap'))                                                                            
knit_hooks$set(document = function(x) {                                                                                        
          gsub('(\\\\end\\{knitrout\\}[\n]+)', '\\1\\\\noindent ', x)                                                                  
          })

 fn = local({
   i = 0
   function(x) {
     i <<- i + 1
#     paste('Figure ', i, ': ', x, sep = '')
     paste('', '', x, sep = '')
   }
 })


suppressMessages(library(ggplot2))
suppressMessages(library(igraph))
suppressMessages(library(Matrix))
suppressMessages(library(lattice))
suppressMessages(library(mclust))
suppressMessages(library(RColorBrewer))
suppressMessages(library(packcircles))
suppressMessages(library(mvtnorm))
suppressMessages(library(printr))
suppressMessages(library(xtable))

```

## Semiparametric spectral modeling of the Drosophila connectome
**[Department of Applied Mathematics and Statistics](http://engineering.jhu.edu/ams/)**      
**[Center for Imaging Science](http://www.cis.jhu.edu)**  
**[Human Language Technology Center of Excellence](http://hltcoe.jhu.edu)**  
**[Johns Hopkins University](http://www.jhu.edu)**  
and  
**[University of Cincinnati](http://business.uc.edu)**  
and  
**[HHMI Janelia Research Campus](hhmi.org)**  

-----

> C.E. Priebe,  Y. Park, M. Tang, A, Athreya, V. Lyzinski, J. Vogelstein,
Y. Qin, B. Cocanougher, K. Eichler, M. Zlatic, A. Cardona,
"[Semiparametric spectral modeling of the Drosophila connectome](http://arxiv.org/abs/1502.03391)," _Journal of the American Statistical Association Application and Case Studies_, submmitted, 2017.


## Abstract

> We present semiparametric spectral modeling of the complete larval Drosophila mushroom body connectome. The resulting connectome code derived via semiparametric Gaussian mixture mod- eling composed with adjacency spectral embedding captures biologically relevant neuronal prop- erties.

> **Keywords**: Connectome; Network; Graph; Spectral embedding; Mixture model; Clustering

<figure>
<img src="diagram-circuit.jpg" width="700px" />
  <figcaption>Illustration of the Drosophila Mushroom Body circuit as a (K = 4)-block directed stochastic block model. This first-order simplification of the structure of the circuit provides a framework for graph embedding inference, and for subsequent Knowledge Base interaction.</figcaption>
</figure>

## Data

HHMI Janelia recently reconstructed the complete wiring diagram of the higher order parallel fiber system for associative learning in the larval Drosophila brain, the mushroom body (MB). Memories are thought to be stored as functional and structural changes in connections between neurons, but the complete circuit architecture of a higher-order learning center involved in memory formation or storage has not been known in any organism ... until now. This data set provides a real and important example for initial investigation into synapse-level structural connectome modeling.  

Our MB connectome was obtained via serial section transmission electron microscopy of an entire larval Drosophila nervous system. This connectome contains the entirety of MB intrinsic neurons called Kenyon cells and all of their pre- and post-synaptic partners.

## Codes and Experiments

To run the experiemnts in the paper, please follow these steps:

### The larval _Drosophila_ mushroom body connectome

Output of this chunk is shown [here](sec2.html).

```{r fig2}
library(mbstructure)
data(MBconnectome)

out <- generate.graph(newrdat, vdf.right)
g <- out$g
vdf <- out$vdf
plotConnections(g, vdf)
```

### Spectral clustering

Output of this chunk is shown [here](sec3.html).

```{r fig4}
dmax <- 50
Xhat <- doEmbed(g, dmax)

Kmax <- 19
mc <- Mclust(Xhat, 2:Kmax)
vdf$cluster <- factor(mc$class)
plotBIC(mc)
plotClustering(Xhat, mc, vdf)
```

### Semiparametric spectral modeling

Output of this chunk is shown [here](sec4.html).  
Warning: This takes several minutes to run on my laptop!

```{r semipar}
sout4 <- synthMB(g, Xhat, vdf, labK=vdf$type, Khat=4, dtype="truth", doplot=TRUE)
semiout <- plotMLE(Xhat, vdf) 
```


### Discussion

#### Directed! Weighted?

Output of this chunk is shown [here](disc-1.html).  
Warning: This takes about _half an hour_ to run on my laptop!

```{r weight}
g.w <-out$g.w
compairARI(g, g.w, vdf)
```

#### Synthetic validation

Output of this chunk is shown [here](disc-2.html).  
Warning: This takes a few minutes to run on my laptop!

```{r synth}
syntheticValidation(g, Xhat, vdf)
```

#### Hemispheric validation: right vs. left

Output of this chunk is shown [here](disc-3.html).  
Warning: This takes a few minutes to run on my laptop!

```{r g-left}
right.vs.left(Xhat, vdf, semiout$out100)
```

## `R` Package

The latest `R` source package can be installed via:
```{r echo=TRUE,eval=FALSE}
install.packages("http://www.cis.jhu.edu/~parky/MBstructure/mbstructure_0.1.0.tar.gz",type="source",method="wget")
```

or

```{r echo=TRUE}
require(devtools)
devtools::install_github("youngser/mbstructure")
```

```{r vn,echo=TRUE, eval=TRUE}
library(help='mbstructure')
```

-----
*prepared by <youngser@jhu.edu> on `r date()`*
